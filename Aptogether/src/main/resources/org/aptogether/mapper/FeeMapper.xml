<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mtbatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.aptogether.mapper.FeeMapper">
	
	<select id="findMember" resultType="org.aptogether.domain.TenantVO">
		select * from member where apt_seq = #{aptSeq}
											    and dong= #{dong}
											    and ho= #{ho}
	</select>
	
 	<insert id="insertFee">
 		<selectKey keyProperty="feeSeq" order="BEFORE" resultType="int">
 			select manage_fee_seq.nextval from dual
 		</selectKey>
 	
		insert into manage_fee values(#{feeSeq}, #{memberSeq}, #{generalFee}, #{securityFee}, #{cleaningFee}, 
														 #{fumigationFee}, #{liftMaintenanceFee}, #{electricityFee}, #{waterFee},
														 #{heatingFee},  to_date(#{payDate}, 'YYYY-MM-DD'))
	</insert>
	
	<select id="listFee" parameterType="org.aptogether.domain.TenantVO" resultType="org.aptogether.domain.FeeVO">
		select ma.* from
									manage_fee ma left join member me
									on ma.member_seq = me.member_seq
									where me.apt_seq = #{aptSeq}
									and me.member_seq = #{memberSeq}
									order by ma.pay_date desc
	</select>

	<select id="listFeeRowNum"  resultType="org.aptogether.domain.FeeVO">
	<![CDATA[
	select *
	from
			(
			select ma.* from 
								manage_fee ma left join member me
								on ma.member_seq = me.member_seq
								where me.apt_seq = #{aptSeq}
								and me.member_seq = #{memberSeq}
								order by ma.pay_date desc
			 ) 
		where rownum <= 6
	]]>
	</select>
	
</mapper>















